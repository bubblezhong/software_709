# API 文档

<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [API 文档](#api-文档)
	- [一、约定](#一约定)
		- [1. API URL 格式](#1-api-url-格式)
		- [2. 请求响应](#2-请求响应)
			- [2.1 请求成功](#21-请求成功)
			- [2.2 请求失败](#22-请求失败)
			- [2.3 服务器错误](#23-服务器错误)
			- [2.4 用户未登录](#24-用户未登录)
			- [2.5 没有权限](#25-没有权限)
	- [二、接口](#二接口)
		- [1. 用户登录](#1-用户登录)
			- [1.1 说明](#11-说明)
			- [1.2 流程](#12-流程)
			- [1.3 请求](#13-请求)
			- [1.4 响应](#14-响应)
					- [1.4.1 登录成功](#141-登录成功)
					- [1.4.2 登录失败](#142-登录失败)
		- [2. 获取当前登录用户的个人信息](#2-获取当前登录用户的个人信息)
			- [2.1 说明](#21-说明)
			- [2.2 流程](#22-流程)
			- [2.3 请求](#23-请求)
			- [2.4 响应](#24-响应)
					- [2.4.1 获取当前登录用户的个人信息成功](#241-获取当前登录用户的个人信息成功)
					- [2.4.2 获取当前登录用户的个人信息失败](#242-获取当前登录用户的个人信息失败)
		- [3. 根据 ID 获取用户个人信息](#3-根据-id-获取用户个人信息)
			- [3.1 说明](#31-说明)
			- [3.2 流程](#32-流程)
			- [3.3 请求](#33-请求)
			- [3.4 响应](#34-响应)
					- [3.4.1 根据 ID 获取用户的个人信息成功](#341-根据-id-获取用户的个人信息成功)
					- [3.4.2 根据 ID 获取用户的个人信息失败](#342-根据-id-获取用户的个人信息失败)
		- [4. 修改当前登录用户个人信息](#4-修改当前登录用户个人信息)
			- [4.1 说明](#41-说明)
			- [4.2 流程](#42-流程)
			- [4.3 请求](#43-请求)
			- [4.4 响应](#44-响应)
					- [4.4.1 修改当前登录用户个人信息成功](#441-修改当前登录用户个人信息成功)
					- [4.4.2 修改当前登录用户的个人信息失败](#442-修改当前登录用户的个人信息失败)
		- [5. 根据 ID 修改用户个人信息](#5-根据-id-修改用户个人信息)
			- [5.1 说明](#51-说明)
			- [5.2 流程](#52-流程)
			- [5.3 请求](#53-请求)
			- [5.4 响应](#54-响应)
					- [5.4.1 根据 ID 修改用户个人信息成功](#541-根据-id-修改用户个人信息成功)
					- [5.4.2 根据 ID 修改用户个人信息失败](#542-根据-id-修改用户个人信息失败)
		- [6. 修改当前登录用户的头像](#6-修改当前登录用户的头像)
			- [6.1 说明](#61-说明)
			- [6.2 流程](#62-流程)
			- [6.3 请求](#63-请求)
			- [6.4 响应](#64-响应)
					- [6.4.1 修改当前登录用户的头像成功](#641-修改当前登录用户的头像成功)
					- [6.4.2 修改当前登录用户的头像失败](#642-修改当前登录用户的头像失败)
		- [7. 根据 ID 修改用户头像](#7-根据-id-修改用户头像)
			- [7.1 说明](#71-说明)
			- [7.2 流程](#72-流程)
			- [7.3 请求](#73-请求)
			- [7.4 响应](#74-响应)
					- [7.4.1 根据 ID 修改用户头像](#741-根据-id-修改用户头像)
					- [7.4.2 根据 ID 修改用户个人信息](#742-根据-id-修改用户个人信息)
	- [三、状态码](#三状态码)

<!-- /TOC -->

## 一、约定

### 1. API URL 格式


API PATH 由三部分组成：`/api`、`版本号`、`具体的 path 路径`

比如下面是一个获取用户信息的 API

```
/api/v0.1/get_user_info
```

### 2. 请求响应

#### 2.1 请求成功

```
// 成功的 code 约定为 0
// message 为简短的描述信息
// data 是返回的数据

{
  code: 0,
  message: '查询用户个人信息成功',
  data: {
    // 用户个人信息
    userinfo: {
      login_name: '张三'，
      gender: '0'
    }
  }  
}
```

#### 2.2 请求失败

```
// 失败的错误码不为0，建议从 1000 开始。由后端定义
// 错误码定义之后，添加到 API 文档的“状态码”表格中
// message 为简短的错误描述信息
// error 为错误详情。开发环境可以有；生产环境不返回
{
  code: 1002,  // 自定义错误状态码
  message: '密码错误',
}
```

#### 2.3 服务器错误

```
// 服务器相关的操作异常，统一返回 5000
// 如数据库连接失败／数据库操作错误
{
  code: 5000,
  message: '服务器错误',
}
```

#### 2.4 用户未登录

用户未登录是经常发生的异常，所以需要统一 API 返回码，在本项目中约定为 6000。

```
{
  code: 6000,
  message: '用户未登录'
}
```

#### 2.5 没有权限

用户没有权限请求某个资源，也是经常发生的异常，所以需要统一 API 返回码，在本项目中约定为 7000。

```
{
  code: 7000,
  message: '没有权限请求该资源'
}
```

## 二、接口

### 1. 用户登录

#### 1.1 说明

在登录页面，用户输入用户名和密码进行登录。

用户登录成功后，后端应该返回用户所具有的权限。

前端根据权限设置响应的菜单。

#### 1.2 流程

```
1. 前端发送用户名密码
2. 后端判断用户名密码是否正确
3. if (正确)
    登录成功
    返回登录成功以及用户权限和用户个人信息
  else
    登录失败
```

#### 1.3 请求

METHOD: `POST`

URL: `/api/v0.1/login`

PARAMS:

```
{
  "login_name": "张三",
  "password": "123456"
}
```

#### 1.4 响应

###### 1.4.1 登录成功

```
{
	"code": 1000,
	"message": "登录成功",
	"data": [
		{
			"ID": 1,
			"DEPARTMENT_ID": 13,
			"USERNAME": "123",
			"NICKNAME": "测试人员1",
			"REAL_NAME": "测试人员1",
			"PASSWORD": "123",
			"BIRTHDAY": "Nov 9, 2016 12:00:00 AM",
			"TELEPHONE": "123-2311231",
			"CREATE_TIME": "Nov 28, 2016 12:00:00 AM",
			"GROUP_ID": 12,
			"INTERFACE_CONFIG": "{\"softwareInformation\":{\"category_name\":1,\"software_name\":1,\"create_time\":1,\"software_type\":1},\"checkInManage\":{\"one\":[\"软件版本\",\"申请人\",\"软件名称\",\"软件谱系\"],\"two\":[\"申请单位\",\"申请时间\",\"状态\"]},\"id\":1}",
			"ROLE_ID": 6,
			"WORK_ID": "num1",
			"GENDER": 1,
			"B_LOGIN_ALLOW": 1,
			"USER_GROUP_LIST": "[5,4,14,15]"
		}
	]
}
```

###### 1.4.2 登录失败

```
// 用户不存在
{
  code: 1001,
  message: '用户不存在',
}

// 用户名或密码错误
{
  code: 1002,
  message: '用户名或密码错误',
}
```

```
{
  code: 5000,
  message: '服务器错误'
}
```

### 2. 获取当前登录用户的个人信息

获取个人信息分为两种：

+ 一是获取当前已经登录用户的个人信息；
+ 二是管理员获取用户的个人信息。

这里是获取当前已经登录用户的个人信息。

#### 2.1 说明

用户登录成功后，后端会将用户的个人信息存储在 SESSION 中。

获取当前登录用户的个人信息，就是后端从 SESSION 中取得用户的 ID，然后根据 ID 从数据库中查询到该用户的个人信息。

#### 2.2 流程

```
前端发送 HTTP 请求，不需要任何参数
后端判断用户是否登录
if (true)
  从 SESSION 中取出 ID
  根据 ID 从数据库中查询出用户个人信息    
else
  返回用户未登录
```

#### 2.3 请求

METHOD: `GET`

URL: `/api/v0.1/get_userinfo`

PARAMS:

```
{}
```

#### 2.4 响应

###### 2.4.1 获取当前登录用户的个人信息成功

```
{
  code: 0,
  data: {
    userinfo: {
      id: 100,
      organization_id: 1,
      role_id: 10,
      avatar: 'abcdefg.png',
      real_name: '张三',
      login_name: 'zhangsan',
      telephone: '021-00000000',
      mobile: '18333333333',
      email: '10000@qq.com',
      address: '武汉市武昌区藏龙大道',
      birthday: '1990-11-09',
      remark: '这是一个普通用户',
      status: 0,
      qq: '1000',
      wechat: 'wwwwxxxx',
      gender: 0,
      create_user_id: 1,
      create_date: '2016-11-09 00:00:00',
      update_date: '',
      update_user: ''
    },
  },
}
```

###### 2.4.2 获取当前登录用户的个人信息失败

```
{
  code: 5000,
  message: '服务器错误'
}
```

```
{
  code: 7000,
  message: '没有权限请求该资源'
}
```

### 3. 根据 ID 获取用户个人信息

获取个人信息分为两种：

+ 一是获取当前已经登录用户的个人信息；
+ 二是根据 ID 获取用户的个人信息。

这里是根据 ID 获取用户的个人信息。

#### 3.1 说明

管理员管理用户的时候，需要根据用户 ID 获取到用户的个人信息。

而普通用户没有权限获取到其他用户的个人信息。

这里需要根据用户权限来判断。具体权限待定。

#### 3.2 流程

```
前端发送 HTTP 请求，不需要任何参数
后端判断用户是否登录
if (true)
  从 SESSION 中取出 ID
  根据 ID 从数据库中查询出用户个人信息    
else
  返回用户未登录
```

#### 3.3 请求

METHOD: `POST`

URL: `/api/v0.1/get_userinfo`

PARAMS:

```
{
  id: 10
}
```

#### 3.4 响应

###### 3.4.1 根据 ID 获取用户的个人信息成功

```
{
  code: 0,
  data: {
    userinfo: {
      id: 100,
      organization_id: 1,
      role_id: 10,
      avatar: 'abcdefg.png',
      real_name: '张三',
      login_name: 'zhangsan',
      telephone: '021-00000000',
      mobile: '18333333333',
      email: '10000@qq.com',
      address: '武汉市武昌区藏龙大道',
      // TODO (jh --> lqp) 时间格式可能需要后端定义一下
      // 看返回什么样的格式
      birthday: '1990-11-09',
      remark: '这是一个普通用户',
      status: 0,
      qq: '1000',
      wechat: 'wwwwxxxx',
      gender: 0,
      create_user_id: 1,
      create_date: '2016-11-09 00:00:00',
      update_date: '',
      update_user: ''
    },
  },
}
```

###### 3.4.2 根据 ID 获取用户的个人信息失败

```
{
  code: 5000,
  message: '服务器错误'
}
```

```
{
  code: 7000,
  message: '没有权限请求该资源'
}
```

### 4. 修改当前登录用户个人信息

同获取用户个人信息一样，修改用户个人信息分为两种：

+ 一是修改当前已经登录用户的个人信息；
+ 二是根据 ID 修改用户的个人信息。

这里是修改当前已经登录用户的个人信息。

#### 4.1 说明

用户登录后，可能需要在个人中心里面修改个人信息。这个时候，就是修改当前登录用户个人信息。

每次前端将用户可修改的字段发送给后端，后端更新所有可修改字段及 `update_date` 和 `update_user`。

#### 4.2 流程

```
前端发送 HTTP 请求，参数是用户修改后的个人信息
后端判断用户是否登录
if (true)
  从 SESSION 中取出 ID
  然后将数据库 User 表中该 ID 对应行的数据更新
else
  返回用户未登录
```

#### 4.3 请求

METHOD: `POST`

URL: `/api/v0.1/edit_userinfo`

PARAMS:

```
{
  real_name: '张三',
  telephone: '021-00000000',
  mobile: '18333333333',
  email: '10000@qq.com',
  address: '武汉市武昌区藏龙大道',
  birthday: '1990-11-09',
  qq: '1000',
  wechat: 'wwwwxxxx',
  gender: 0,
  update_date: '',
  update_user: ''
}
```

后端需要更新的字段，除了上面请求参数里面的字段，还包括 `update_date` 和 `update_user`。

其中 `update_date` 的值当前时间，update_user 的值是当前用户的 ID。

#### 4.4 响应

###### 4.4.1 修改当前登录用户个人信息成功

修改成功后，需要返回修改后的用户个人信息给前端。

```
{
  code: 0,
  data: {
    userinfo: {
      id: 100,
      organization_id: 1,
      role_id: 10,
      avatar: 'abcdefg.png',
      real_name: '张三',
      login_name: 'zhangsan',
      telephone: '021-00000000',
      mobile: '18333333333',
      email: '10000@qq.com',
      address: '武汉市武昌区藏龙大道',
      birthday: '1990-11-09',
      remark: '这是一个普通用户',
      status: 0,
      qq: '1000',
      wechat: 'wwwwxxxx',
      gender: 0,
      create_user_id: 1,
      create_date: '2016-11-09 00:00:00',
      update_date: '',
      update_user: ''
    },
  },
}
```

###### 4.4.2 修改当前登录用户的个人信息失败

```
{
  code: 5000,
  message: '服务器错误'
}
```

```
{
  code: 7000,
  message: '没有权限请求该资源'
}
```


### 5. 根据 ID 修改用户个人信息

同获取用户个人信息一样，修改用户个人信息分为两种：

+ 一是修改当前已经登录用户的个人信息；
+ 二是根据 ID 修改用户的个人信息。

这里是根据 ID 修改用户个人信息。

#### 5.1 说明

管理员管理用户的时候，需要根据 ID 修改用户个人信息。

每次前端将用户可修改的字段发送给后端，后端更新所有可修改字段及 `update_date` 和 `update_user`。

#### 5.2 流程

```
前端发送 HTTP 请求，参数是用户修改后的个人信息
后端判断用户是否登录
if (true)
  从 SESSION 中取出 ID
  然后将数据库 User 表中该 ID 对应行的数据更新
else
  返回用户未登录
```

#### 5.3 请求

METHOD: `POST`

URL: `/api/v0.1/edit_userinfo_by_id`

PARAMS:

```
{
  id: 100,
  organization_id: 1,
  role_id: 10,
  real_name: '张三',
  login_name: 'zhangsan',
  telephone: '021-00000000',
  mobile: '18333333333',
  email: '10000@qq.com',
  address: '武汉市武昌区藏龙大道',
  birthday: '1990-11-09',
  remark: '这是一个普通用户',
  status: 0,
  qq: '1000',
  wechat: 'wwwwxxxx',
  gender: 0
}
```

后端需要更新的字段，除了上面请求参数里面的字段，还包括 `update_date` 和 `update_user`。

其中 `update_date` 的值当前时间，update_user 的值是当前用户的 ID。

#### 5.4 响应

###### 5.4.1 根据 ID 修改用户个人信息成功

修改成功后，需要返回修改后的用户个人信息给前端。

```
{
  code: 0,
  data: {
    userinfo: {
      id: 100,
      organization_id: 1,
      role_id: 10,
      avatar: 'abcdefg.png',
      real_name: '张三',
      login_name: 'zhangsan',
      telephone: '021-00000000',
      mobile: '18333333333',
      email: '10000@qq.com',
      address: '武汉市武昌区藏龙大道',
      birthday: '1990-11-09',
      remark: '这是一个普通用户',
      status: 0,
      qq: '1000',
      wechat: 'wwwwxxxx',
      gender: 0,
      create_user_id: 1,
      create_date: '2016-11-09 00:00:00',
      update_date: '',
      update_user: ''
    },
  },
}
```

###### 5.4.2 根据 ID 修改用户个人信息失败

```
{
  code: 5000,
  message: '服务器错误'
}
```

```
{
  code: 7000,
  message: '没有权限请求该资源'
}
```


### 6. 修改当前登录用户的头像

同获取用户个人信息一样，修改用户头像分为两种：

+ 一是修改当前已经登录用户的头像；
+ 二是根据 ID 修改用户的头像。

这里是修改当前已经登录用户的头像。

#### 6.1 说明

用户登录后，可能需要在个人中心里面修改头像。这个时候，就是修改当前登录用户头像。

管理员上传新的用户头像文件，后端更新 `avatar` 字段及 `update_date` 和 `update_user`。

#### 6.2 流程

```
前端发送 HTTP 请求，参数是用户修改后的头像信息（这里需要处理图片上传）
后端判断用户是否登录
if (true)
  从 SESSION 中取出 ID
  然后将数据库 User 表中该 ID 对应行的 avatar 字段更新
else
  返回用户未登录
```

#### 6.3 请求

METHOD: `POST`

URL: `/api/v0.1/edit_user_avatar`

PARAMS:

```
// TODO (jh) 因为是文件上传，这里待定
{}
```

后端需要更新的字段，除了上面请求参数里面的字段，还包括 `update_date` 和 `update_user`。

其中 `update_date` 的值当前时间，update_user 的值是当前用户的 ID。

#### 6.4 响应

###### 6.4.1 修改当前登录用户的头像成功

修改成功后，需要返回修改后的用户个人信息给前端。

```
{
  code: 0,
  data: {
    userinfo: {
      id: 100,
      organization_id: 1,
      role_id: 10,
      avatar: 'abcdefg.png',
      real_name: '张三',
      login_name: 'zhangsan',
      telephone: '021-00000000',
      mobile: '18333333333',
      email: '10000@qq.com',
      address: '武汉市武昌区藏龙大道',
      birthday: '1990-11-09',
      remark: '这是一个普通用户',
      status: 0,
      qq: '1000',
      wechat: 'wwwwxxxx',
      gender: 0,
      create_user_id: 1,
      create_date: '2016-11-09 00:00:00',
      update_date: '',
      update_user: ''
    },
  },
}
```

###### 6.4.2 修改当前登录用户的头像失败

```
{
  code: 5000,
  message: '服务器错误'
}
```

```
{
  code: 7000,
  message: '没有权限请求该资源'
}
```





### 7. 根据 ID 修改用户头像

同获取用户个人信息一样，修改用户个人头像分为两种：

+ 一是修改当前已经登录用户的头像；
+ 二是根据 ID 修改用户的头像。

这里是根据 ID 修改用户头像。

#### 7.1 说明

管理员管理用户的时候，需要根据 ID 修改用户头像。

管理员上传新的用户头像文件，后端更新 `avatar` 字段及 `update_date` 和 `update_user`。

#### 7.2 流程

```
前端发送 HTTP 请求，参数是用户修改后的头像文件
后端判断用户是否登录
if (true)
  从 SESSION 中取出 ID
  然后将数据库 User 表中该 ID 对应行的 `avatar` 字段更新
else
  返回用户未登录
```

#### 7.3 请求

METHOD: `POST`

URL: `/api/v0.1/edit_user_avatar_by_id`

PARAMS:

```
// TODO (jh) 因为是文件上传，这里待定
{}
```

后端需要更新的字段，除了上面请求参数里面的字段，还包括 `update_date` 和 `update_user`。

其中 `update_date` 的值当前时间，update_user 的值是当前用户的 ID。

#### 7.4 响应

###### 7.4.1 根据 ID 修改用户头像

修改成功后，需要返回修改后的用户个人信息给前端。

```
{
  code: 0,
  data: {
    userinfo: {
      id: 100,
      organization_id: 1,
      role_id: 10,
      avatar: 'abcdefg.png',
      real_name: '张三',
      login_name: 'zhangsan',
      telephone: '021-00000000',
      mobile: '18333333333',
      email: '10000@qq.com',
      address: '武汉市武昌区藏龙大道',
      birthday: '1990-11-09',
      remark: '这是一个普通用户',
      status: 0,
      qq: '1000',
      wechat: 'wwwwxxxx',
      gender: 0,
      create_user_id: 1,
      create_date: '2016-11-09 00:00:00',
      update_date: '',
      update_user: ''
    },
  },
}
```

###### 7.4.2 根据 ID 修改用户个人信息

```
{
  code: 5000,
  message: '服务器错误'
}
```

```
{
  code: 7000,
  message: '没有权限请求该资源'
}
```











## 三、状态码

状态码一览表。

有新的状态码之后，统一加入到该表格中。

|状态码|描述|
|:---:|:---:|
|0|成功|
|5000|服务器错误|
|6000|用户未登录|
|7000|没有权限获取该资源|
|1001|用户不存在|
|1002|密码错误|
